# Адаптивный алгоритм работы светофоров на перекрестке

Рассмотрим перекресток, на котором несколько светофоров, регулирующих движение автомобилей (4 шт), и несколько - движение пешеходов по переходам (8 шт):

- У пешеходных светофоров 2 состояния, у автомобильных - 3.
- В каждый светофор встроена камера, которая фиксирует количество автомобилей/пешеходов в той очереди, для которых светофор установлен. Это очередь на противоположной стороне пешехода/перекрестка (см. рисунок).
- Автомобили при проезде перекрестка едут либо прямо, либо направо. Люди и автомобили осуществляют переход или проезд перекрестка по одному, уменьшая размер соответствующей очереди на 1.

Каждый светофор имеет уникальный id. Светофоры могут общаться при помощи событий, отсылая события друг другу по id. Пересылаемые события - это некоторые контейнеры с данными (например, там может лежать количество людей/автомобилей в очереди, id отправителя, текущее состояние светофора).

Светофор может взводить таймер, который через заданное время отсылает заданное событие на заданный id. Отправка события - это помещение контейнера в очередь событий для светофора; у каждого светофора очередь своя собственная. Светофоры обрабатывают события параллельно, независимо друг от друга. При этом каждый светофор обрабатывает свои события последовательно, в том порядке, в каком они помещаются в очередь.

Светофор может получить информацию о текущем состоянии любого другого светофора синхронно (не через событие).

## Задача
Придумать и описать адаптивный алгоритм работы светофоров для оптимизации общей пропускной способности перекрестка в зависимости от ситуации на перекрестке.

# Алгоритм работы адаптивного светофора

1. **Начало работы светофоров**
   - Каждый светофор начинает мониторить свою очередь транспортных средств или пешеходов и состояние других светофоров в сети.

2. **Проверка очереди**
   - Если в очереди есть объекты, светофор выполняет действия в зависимости от текущего состояния:
     - Зеленый свет: проверяет условия для возможного переключения на красный.
     - Желтый свет (после зеленого): автоматически переходит на красный.
     - Красный свет: проверяет, не пора ли включать зеленый, если время ожидания превышено.

3. **Управление зеленым светом**
   - Если светофор зеленый и в очереди есть объекты:
     - Проверить, есть ли светофоры с:
       - Зеленым светом или
       - Более длинной очередью и превышенным таймером ожидания на красный.
     - Если такие светофоры есть и текущий зеленый горит достаточно долго — светофор переключается на красный.
     - Если таких светофоров нет — зеленый свет остается активным.

4. **Управление красным светом**
   - Если светофор красный:
     - Если превышено время ожидания зеленого света:
       - Проверить, нет ли светофоров, которые ждут зеленый свет дольше текущего:
         - Если таких нет и другие светофоры не показывают зеленый или желтый — включить зеленый свет.
         - Если есть светофоры с большим временем ожидания — остаётся красным.
     - Если время ожидания не превышено, светофор остаётся на красном.

5. **Управление желтым светом**
   - Если светофор желтый после зеленого:
     - Автоматически переходит на красный.
   - Если желтый после красного:
     - Проверить, есть ли светофоры с зеленым или желтым:
       - Если таких нет — включить зеленый свет.
       - Если такие есть — остаётся красным.

6. **Взаимодействие с другими светофорами**
   - Светофоры обмениваются данными о:
     - Размере очередей.
     - Текущем состоянии (зеленый/красный/желтый).
     - Длительности зеленого света.
   - На основе этих данных светофор может адаптировать свою стратегию работы.

7. **Адаптивное управление**
   - Светофоры динамически изменяют время зеленого света, основываясь на данных о текущей дорожной ситуации:
     - Если очередь больше — увеличить время зеленого.
     - Если на других светофорах очередь больше — уменьшить время зеленого или переключиться на красный.
   - Оптимизация распределения времени между зелеными и красными сигналами позволяет минимизировать простои.
